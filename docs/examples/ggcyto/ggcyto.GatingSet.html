---
title: "Visualize GatingSet with ggcyto"
output:
  html_document:
    fig_height: 3
    fig_width: 4
    keep_md: yes
    toc: yes
    toc_float: true
vignette: >    
  %\VignetteIndexEntry{Visualize GatingSet with ggcyto}        
  %\VignetteEngine{knitr::rmarkdown}
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p>By specifying the dimensions through <code>aes</code> and selecting the cell population through <code>subset</code>, <code>ggcyto</code> can easily visualize the gated data stored in <code>GatingSet</code>.</p>
<pre class="r"><code>p &lt;- ggcyto(gs, aes(x = CD4, y = CD8), subset = &quot;CD3+&quot;) 
# 2d plot 
p &lt;- p + geom_hex(bins = 64)
p</code></pre>
<p><img src="docs/examples/ggcyto/ggcyto.GatingSet_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<div id="ggcyto_par_set" class="section level2">
<h2>ggcyto_par_set</h2>
<p>We can use the instrument range to automatically filter out these outlier cell events</p>
<pre class="r"><code>p + ggcyto_par_set(limits = &quot;instrument&quot;)</code></pre>
<p><img src="docs/examples/ggcyto/ggcyto.GatingSet_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Or by setting limits manually</p>
<pre class="r"><code>myPars &lt;- ggcyto_par_set(limits = list(x = c(0,3.5e3), y = c(-10, 4.1e3)))
p &lt;- p + myPars# or xlim(0,3.5e3) + ylim(-10, 4e3) 
p</code></pre>
<p><img src="docs/examples/ggcyto/ggcyto.GatingSet_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>To check what kind of visualization parameters can be changed through <code>ggcyto_par_set</code>, simply print the default settings</p>
<pre class="r"><code>ggcyto_par_default()</code></pre>
<pre><code>## $limits
## [1] &quot;data&quot;
## 
## $facet
## &lt;ggproto object: Class FacetWrap, Facet, gg&gt;
##     compute_layout: function
##     draw_back: function
##     draw_front: function
##     draw_labels: function
##     draw_panels: function
##     finish_data: function
##     init_scales: function
##     map_data: function
##     params: list
##     setup_data: function
##     setup_params: function
##     shrink: TRUE
##     train_scales: function
##     vars: function
##     super:  &lt;ggproto object: Class FacetWrap, Facet, gg&gt;
## 
## $hex_fill
## &lt;ScaleContinuous&gt;
##  Range:  
##  Limits:    0 --    1
## 
## $lab
## $labels
## [1] &quot;both&quot;
## 
## attr(,&quot;class&quot;)
## [1] &quot;labs_cyto&quot;
## 
## attr(,&quot;class&quot;)
## [1] &quot;ggcyto_par&quot;</code></pre>
</div>
<div id="geom_gate" class="section level2">
<h2>geom_gate</h2>
<p>To plot a gate, simply pass the gate name to the <code>geom_gate</code> layer</p>
<pre class="r"><code>p + geom_gate(&quot;CD4&quot;)</code></pre>
<p><img src="docs/examples/ggcyto/ggcyto.GatingSet_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>More than one gate can be added as long as they share the same parent and dimensions</p>
<pre class="r"><code>p &lt;- p + geom_gate(c(&quot;CD4&quot;,&quot;CD8&quot;)) # short for geom_gate(&quot;CD8&quot;) + geom_gate(&quot;CD4&quot;)
p</code></pre>
<p><img src="docs/examples/ggcyto/ggcyto.GatingSet_files/figure-html/unnamed-chunk-8-1.png" width="672" />
## geom_stats
By default, stats for all gate layers are added through empty <code>geom_stats</code> layer.</p>
<pre class="r"><code>p + geom_stats() + labs_cyto(&quot;marker&quot;)</code></pre>
<p><img src="docs/examples/ggcyto/ggcyto.GatingSet_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>Note that we choose to only display marker on axis through <code>labs_cyto</code> layer here.</p>
<p>To add stats just for one specific gate, we can pass the gate name to <code>geom_gate</code></p>
<pre class="r"><code>p + geom_stats(&quot;CD4&quot;)</code></pre>
<p><img src="docs/examples/ggcyto/ggcyto.GatingSet_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>stats type, background color and position are all adjustable.</p>
<pre class="r"><code>p + geom_stats(&quot;CD4&quot;, type = &quot;count&quot;, size = 6,  color = &quot;white&quot;, fill = &quot;black&quot;, adjust = 0.3)</code></pre>
<p><img src="docs/examples/ggcyto/ggcyto.GatingSet_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>When ‘subset’ is not specified, it is at abstract status thus can not be visualized</p>
<pre class="r"><code>p &lt;- ggcyto(gs, aes(x = CD4, y = CD8)) + geom_hex() + myPars
p</code></pre>
<pre><code>## Error in fortify_fs.GatingSet(gs): &#39;subset&#39; must be instantiated by the actual node name!
## Make sure either &#39;subset&#39; is specified or the &#39;geom_gate&#39; layer is added.</code></pre>
<p>unless it is instantiated by the gate layer, i.e. lookup the gating tree for the parent node based on the given gates in <code>geom_gate</code></p>
<pre class="r"><code>p &lt;- p + geom_gate(c(&quot;CD4&quot;, &quot;CD8&quot;))
p</code></pre>
<p><img src="docs/examples/ggcyto/ggcyto.GatingSet_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
</div>
<div id="geom_overlay" class="section level2">
<h2>geom_overlay</h2>
<p>With <code>geom_overlay</code>, you can easily overlay the additional cell populations (whose gates are not defined in the current projection) on top of the existing plot.</p>
<pre class="r"><code>p + geom_overlay(&quot;CD8/CCR7- 45RA+&quot;, col = &quot;black&quot;, size = 0.1, alpha = 0.4)</code></pre>
<p><img src="docs/examples/ggcyto/ggcyto.GatingSet_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p><code>geom_overlay</code> automatically determines the overlay type (<code>goem_point</code> or <code>geom_density</code>) based on the number of dimensions specified in <code>ggcyto</code> constructor.
Note that we change the default <code>y</code> axis from <code>density</code> to <code>count</code> in order to make the scales comparable for the stacked density layers. They are wrapped with <code>..</code> because they belong to the <code>computed variables</code>.</p>
<pre class="r"><code>p &lt;- ggcyto(gs, aes(x = CD4), subset = &quot;CD3+&quot;) + geom_density(aes(y = ..count..))
p + geom_overlay(&quot;CD8/CCR7- 45RA+&quot;, aes(y = ..count..), fill = &quot;red&quot;)</code></pre>
<p><img src="docs/examples/ggcyto/ggcyto.GatingSet_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
</div>
<div id="subset" class="section level2">
<h2>subset</h2>
<p>Alternatively, we can choose to plot all children of one specified parent and projections</p>
<pre class="r"><code>p &lt;- ggcyto(gs, aes(x = 38, y = DR), subset = &quot;CD4&quot;) + geom_hex(bins = 64) + geom_gate() + geom_stats()
p</code></pre>
<p><img src="docs/examples/ggcyto/ggcyto.GatingSet_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>Or we can add gate layer to any arbitary node instead of its parent node</p>
<pre class="r"><code>ggcyto(gs, subset = &quot;root&quot;, aes(x = CD4, y = CD8)) + geom_hex(bins = 64) + geom_gate(&quot;CD4&quot;) + myPars</code></pre>
<p><img src="docs/examples/ggcyto/ggcyto.GatingSet_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
</div>
<div id="axis_x_inverse_trans" class="section level2">
<h2>axis_x_inverse_trans</h2>
<p>Sometime it is helpful to display the axis label in raw scale by inverse transforming the axis without affecting the data</p>
<pre class="r"><code>p + axis_x_inverse_trans() + axis_y_inverse_trans()</code></pre>
<p><img src="docs/examples/ggcyto/ggcyto.GatingSet_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<pre class="r"><code>#add filter (consistent with `margin` behavior in flowViz)
# ggcyto(gs, aes(x = CD4, y = CD8), subset = &quot;CD3+&quot;, filter = marginalFilter)  + geom_hex(bins = 32, na.rm = T)</code></pre>
</div>
