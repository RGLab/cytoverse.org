---
title: 'ggcyto : Visualize `Cytometry` data with `ggplot`'
output:
  html_document:
    fig_height: 2
    fig_width: 2
    keep_md: yes
    toc: yes
    toc_float: true
vignette: >    
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{Feature summary of ggcyto}
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<pre class="r"><code>library(ggcyto)
dataDir &lt;- system.file(&quot;extdata&quot;,package=&quot;flowWorkspaceData&quot;)</code></pre>
<div id="suppoort-3-types-of-plot-constructor" class="section level2">
<h2>1: suppoort <code>3</code> types of plot constructor</h2>
<ul>
<li>represent different levels of complexity and flexibility</li>
<li>meet the needs of various plot applications</li>
<li>suitable for users at different levels of coding skills.</li>
</ul>
<div id="low-level-ggplot" class="section level3">
<h3>low level: <code>ggplot</code></h3>
<p>The overloaded <code>fority</code> methods empower <code>ggplot</code> to work with all the major Cytometry data structures right away, which allows users to do all kinds of highly customized and versitled plots.</p>
<div id="gatingset" class="section level4">
<h4><code>GatingSet</code></h4>
<pre class="r"><code>gs &lt;- load_gs(list.files(dataDir, pattern = &quot;gs_manual&quot;,full = TRUE))
attr(gs, &quot;subset&quot;) &lt;- &quot;CD3+&quot;
ggplot(gs, aes(x = `&lt;B710-A&gt;`, y = `&lt;R780-A&gt;`)) + geom_hex(bins = 128) + scale_fill_gradientn(colours = gray.colors(9))</code></pre>
<p><img src="docs/examples/ggcyto/Top_features_of_ggcyto_files/figure-html/unnamed-chunk-3-1.png" width="480" /></p>
</div>
<div id="flowsetncdfflowsetflowframe" class="section level4">
<h4><code>flowSet/ncdfFlowSet/flowFrame</code></h4>
<pre class="r"><code>fs &lt;- gs_pop_get_data(gs, &quot;CD3+&quot;)
ggplot(fs, aes(x = `&lt;B710-A&gt;`)) + geom_density(fill = &quot;blue&quot;, alpha= 0.5)</code></pre>
<p><img src="docs/examples/ggcyto/Top_features_of_ggcyto_files/figure-html/unnamed-chunk-4-1.png" width="480" /></p>
</div>
<div id="gates" class="section level4">
<h4><code>gates</code></h4>
<pre class="r"><code>gates &lt;- filterList(gs_pop_get_gate(gs, &quot;CD8&quot;))
ggplot(gs, aes(x = `&lt;B710-A&gt;`, y = `&lt;R780-A&gt;`)) + geom_hex(bins = 128) + geom_polygon(data = gates, fill = NA, col = &quot;purple&quot;)</code></pre>
<p><img src="docs/examples/ggcyto/Top_features_of_ggcyto_files/figure-html/unnamed-chunk-5-1.png" width="480" /></p>
</div>
</div>
<div id="medium-level-ggcyto" class="section level3">
<h3>medium level: <code>ggcyto</code></h3>
<p><code>ggcyto</code> constructor along with overloaded <code>+</code> operator encapsulate lots of details that might be tedious and intimidating for many users.</p>
<pre class="r"><code>ggcyto(gs, aes(x = CD4, y = CD8)) + geom_hex(bins = 128) + geom_gate(&quot;CD8&quot;)</code></pre>
<p><img src="docs/examples/ggcyto/Top_features_of_ggcyto_files/figure-html/unnamed-chunk-6-1.png" width="480" /></p>
<p>It simplies the plotting by:
* add a default scale_fill_gradientn for you
* fuzzy-matching in <code>aes</code> by either detector or fluorochromes names
* determine the <code>parent</code> popoulation automatically
* exact and plot the gate object by simply referring to the <code>child</code> population name</p>
</div>
<div id="top-level-autoplot" class="section level3">
<h3>top level: <code>autoplot</code></h3>
<p>Inheriting the spirit from ggplotâ€™s <code>Quick plot</code>, it further simply the plotting job by hiding more details from users and taking more assumptions for the plot.</p>
<ul>
<li>when plotting <code>flowSet</code>, it determines <code>geom</code> type automatically by the number of <code>dim</code> supplied</li>
<li>for <code>GatingSet</code>, it further skip the need of <code>dim</code> by guessing it from the <code>children</code> gate</li>
</ul>
<pre class="r"><code>#1d
autoplot(fs, &quot;CD4&quot;)</code></pre>
<p><img src="docs/examples/ggcyto/Top_features_of_ggcyto_files/figure-html/unnamed-chunk-7-1.png" width="480" /></p>
<pre class="r"><code>#2d
autoplot(fs, &quot;CD4&quot;, &quot;CD8&quot;, bins = 64)</code></pre>
<p><img src="docs/examples/ggcyto/Top_features_of_ggcyto_files/figure-html/unnamed-chunk-7-2.png" width="480" /></p>
<pre class="r"><code>autoplot(gs, c(&quot;CD4&quot;, &quot;CD8&quot;), bins = 64)</code></pre>
<p><img src="docs/examples/ggcyto/Top_features_of_ggcyto_files/figure-html/unnamed-chunk-7-3.png" width="480" /></p>
</div>
</div>
<div id="in-line-transformation" class="section level2">
<h2>2: in-line transformation</h2>
<p>It is done by different <code>scales</code> layers speically designed for <code>cytometry</code></p>
<pre class="r"><code>data(GvHD)
fr &lt;- GvHD[[1]]
p &lt;- autoplot(fr, &quot;FL1-H&quot;)
p #raw scale</code></pre>
<p><img src="docs/examples/ggcyto/Top_features_of_ggcyto_files/figure-html/unnamed-chunk-8-1.png" width="480" /></p>
<pre class="r"><code>p + scale_x_logicle() #flowCore logicle scale</code></pre>
<p><img src="docs/examples/ggcyto/Top_features_of_ggcyto_files/figure-html/unnamed-chunk-8-2.png" width="480" /></p>
<pre class="r"><code>p + scale_x_flowJo_fasinh() # flowJo fasinh</code></pre>
<p><img src="docs/examples/ggcyto/Top_features_of_ggcyto_files/figure-html/unnamed-chunk-8-3.png" width="480" /></p>
<pre class="r"><code>p + scale_x_flowJo_biexp() # flowJo biexponential</code></pre>
<p><img src="docs/examples/ggcyto/Top_features_of_ggcyto_files/figure-html/unnamed-chunk-8-4.png" width="480" /></p>
</div>
<div id="generic-geom_gate-layer" class="section level2">
<h2>3: generic <code>geom_gate</code> layer</h2>
<p>It hides the complex details pf plotting different geometric shapes</p>
<pre class="r"><code>fr &lt;- fs[[1]]
p &lt;- autoplot(fr,&quot;CD4&quot;, &quot;CD8&quot;) + ggcyto_par_set(limits = &quot;instrument&quot;)
#1d gate vertical
gate_1d_v &lt;- openCyto::gate_mindensity(fr, &quot;&lt;B710-A&gt;&quot;)
p + geom_gate(gate_1d_v)</code></pre>
<p><img src="docs/examples/ggcyto/Top_features_of_ggcyto_files/figure-html/unnamed-chunk-9-1.png" width="480" /></p>
<pre class="r"><code>#1d gate horizontal
gate_1d_h &lt;- openCyto::gate_mindensity(fr, &quot;&lt;R780-A&gt;&quot;)
p + geom_gate(gate_1d_h)</code></pre>
<p><img src="docs/examples/ggcyto/Top_features_of_ggcyto_files/figure-html/unnamed-chunk-9-2.png" width="480" /></p>
<pre class="r"><code>#2d rectangle gate
gate_rect &lt;- rectangleGate(&quot;&lt;B710-A&gt;&quot; = c(gate_1d_v@min, 4e3), &quot;&lt;R780-A&gt;&quot; = c(gate_1d_h@min, 4e3))
p + geom_gate(gate_rect)</code></pre>
<p><img src="docs/examples/ggcyto/Top_features_of_ggcyto_files/figure-html/unnamed-chunk-9-3.png" width="480" /></p>
<pre class="r"><code>#ellipsoid Gate
gate_ellip &lt;- gh_pop_get_gate(gs[[1]], &quot;CD4&quot;)
class(gate_ellip)</code></pre>
<pre><code>## [1] &quot;ellipsoidGate&quot;
## attr(,&quot;package&quot;)
## [1] &quot;flowCore&quot;</code></pre>
<pre class="r"><code>p + geom_gate(gate_ellip)</code></pre>
<p><img src="docs/examples/ggcyto/Top_features_of_ggcyto_files/figure-html/unnamed-chunk-9-4.png" width="480" /></p>
</div>
<div id="geom_stats" class="section level2">
<h2>4: <code>geom_stats</code></h2>
<pre class="r"><code>p &lt;- ggcyto(gs, aes(x = &quot;CD4&quot;, y = &quot;CD8&quot;), subset = &quot;CD3+&quot;) + geom_hex()
p + geom_gate(&quot;CD4&quot;) + geom_stats()</code></pre>
<p><img src="docs/examples/ggcyto/Top_features_of_ggcyto_files/figure-html/unnamed-chunk-10-1.png" width="480" /></p>
<pre class="r"><code>p + geom_gate(&quot;CD4&quot;) + geom_stats(type = &quot;count&quot;) #display cell counts </code></pre>
<p><img src="docs/examples/ggcyto/Top_features_of_ggcyto_files/figure-html/unnamed-chunk-10-2.png" width="480" /></p>
</div>
<div id="axis_inverse_trans" class="section level2">
<h2>5: <code>axis_inverse_trans</code></h2>
<p>It can display the <code>log</code> scaled data in the original value</p>
<pre class="r"><code>p # axis display the transformed values</code></pre>
<p><img src="docs/examples/ggcyto/Top_features_of_ggcyto_files/figure-html/unnamed-chunk-11-1.png" width="480" /></p>
<pre class="r"><code>p + axis_x_inverse_trans() # restore the x axis to the raw values</code></pre>
<p><img src="docs/examples/ggcyto/Top_features_of_ggcyto_files/figure-html/unnamed-chunk-11-2.png" width="480" /></p>
<p>It currently only works with <code>GatingSet</code>.</p>
</div>
<div id="auto-limits" class="section level2">
<h2>6: auto limits</h2>
<p>Optionally you can set limits by <code>instrument</code> or <code>data</code> range</p>
<pre class="r"><code>p &lt;- p + ggcyto_par_set(limits = &quot;instrument&quot;)
p</code></pre>
<p><img src="docs/examples/ggcyto/Top_features_of_ggcyto_files/figure-html/unnamed-chunk-12-1.png" width="480" /></p>
</div>
<div id="labs_cyto" class="section level2">
<h2>7: labs_cyto</h2>
<p>You can choose between <code>marker</code> and <code>channel</code> names (or <code>both</code> by default)</p>
<pre class="r"><code>p + labs_cyto(&quot;markers&quot;)</code></pre>
<p><img src="docs/examples/ggcyto/Top_features_of_ggcyto_files/figure-html/unnamed-chunk-13-1.png" width="480" /></p>
</div>
<div id="ggcyto_par_set" class="section level2">
<h2>8: <code>ggcyto_par_set</code></h2>
<p>It aggregates the different settings in one layer</p>
<pre class="r"><code>#put all the customized settings in one layer
mySettings &lt;- ggcyto_par_set(limits = &quot;instrument&quot;
                             , facet = facet_wrap(&quot;name&quot;)
                             , hex_fill = scale_fill_gradientn(colours = rev(RColorBrewer::brewer.pal(11, &quot;Spectral&quot;)))
                            , lab = labs_cyto(&quot;marker&quot;)
                            )
# and use it repeatly in the plots later (similar to the `theme` concept)
p + mySettings</code></pre>
<p><img src="docs/examples/ggcyto/Top_features_of_ggcyto_files/figure-html/unnamed-chunk-14-1.png" width="480" /></p>
<p>Currently we only support <code>4</code> settings, but will add more in future.</p>
</div>
<div id="as.ggplot" class="section level2">
<h2>9: <code>as.ggplot</code></h2>
<p>It allows user to convert <code>ggcyto</code> objects to pure <code>ggplot</code> objects for further the manipulating jobs that can not be done within <code>ggcyto</code> framework.</p>
<pre class="r"><code>class(p) # may not fully compatile with all the `ggplot` functions</code></pre>
<pre><code>## [1] &quot;ggcyto_GatingSet&quot;
## attr(,&quot;package&quot;)
## [1] &quot;ggcyto&quot;</code></pre>
<pre class="r"><code>p1 &lt;- as.ggplot(p)
class(p1) # a pure ggplot object, thus can work with all the `ggplot` features</code></pre>
<pre><code>## [1] &quot;gg&quot;     &quot;ggplot&quot;</code></pre>
</div>
<div id="ggcyto_layout" class="section level2">
<h2>10: ggcyto_layout</h2>
<p>Layout many gate plots on the same page</p>
<p>When plooting a <code>GatingHierarchy</code>, multiple cell populations with their asssociated gates can be plotted in different panels of the same plot.</p>
<pre class="r"><code>gh &lt;- gs[[1]]
nodes &lt;- gs_get_pop_paths(gh, path = &quot;auto&quot;)[c(3:9, 14)]
nodes</code></pre>
<pre><code>## [1] &quot;singlets&quot;    &quot;CD3+&quot;        &quot;CD4&quot;         &quot;CD4/38- DR+&quot; &quot;CD4/38+ DR+&quot;
## [6] &quot;CD4/38+ DR-&quot; &quot;CD4/38- DR-&quot; &quot;CD8&quot;</code></pre>
<pre class="r"><code>p &lt;- autoplot(gh, nodes, bins = 64)
class(p)</code></pre>
<pre><code>## [1] &quot;ggcyto_GatingLayout&quot;
## attr(,&quot;package&quot;)
## [1] &quot;ggcyto&quot;</code></pre>
<pre class="r"><code>p</code></pre>
<p><img src="docs/examples/ggcyto/Top_features_of_ggcyto_files/figure-html/unnamed-chunk-16-1.png" width="480" /></p>
<p>As you see, this generates a special <code>ggcyto_GatingLayout</code> object which is a container storing multiple <code>ggcyto</code> objects.
You can do more about the plot layout with the helper function <code>ggcyto_arrange</code>.
For example, to arrange it as one-row gtable object</p>
<pre class="r"><code>gt &lt;- ggcyto_arrange(p, nrow = 1)
class(gt)</code></pre>
<pre><code>## [1] &quot;gtable&quot; &quot;gTree&quot;  &quot;grob&quot;   &quot;gDesc&quot;</code></pre>
<pre class="r"><code>plot(gt)</code></pre>
<p><img src="docs/examples/ggcyto/Top_features_of_ggcyto_files/figure-html/unnamed-chunk-17-1.png" width="480" /></p>
<p>or even combine it with other <code>ggcyto_GatingLayout</code> objects(or any <code>gtable</code> objects) and print it on the sampe page</p>
<pre class="r"><code>p2 &lt;- autoplot(gh_pop_get_data(gh, &quot;CD3+&quot;)[,5:8]) # some density plot
p2@arrange.main &lt;- &quot;&quot;#clear the default title
gt2 &lt;- ggcyto_arrange(p2, nrow = 1)

gt3 &lt;- gridExtra::gtable_rbind(gt, gt2)
plot(gt3)</code></pre>
<p><img src="docs/examples/ggcyto/Top_features_of_ggcyto_files/figure-html/unnamed-chunk-18-1.png" width="480" /></p>
</div>
