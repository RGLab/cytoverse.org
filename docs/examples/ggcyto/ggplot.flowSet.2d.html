---
title: "2d scatter plot of cytometry data with ggplot2"
author: "Mike Jiang"
output:
  html_document:
    keep_md: yes
vignette: >    
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{2d scatter plot of cytometry data with ggplot2}        
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p><code>ggcyto</code> makes <code>ggplot2</code> to be able to work with <code>Cytometry</code> data, namely <code>flowSet/ncdfFlowSet</code> or <code>flowFrame</code> S4 objects.</p>
<pre class="r"><code>library(ggcyto)
data(GvHD)
fs &lt;- GvHD[subset(pData(GvHD), Patient %in%5:7 &amp; Visit %in% c(5:6))[[&quot;name&quot;]]]
fr &lt;- fs[[1]]</code></pre>
<pre class="r"><code># 2d hex
p &lt;- ggplot(fr, aes(x = `FSC-H`, y =  `SSC-H`))
p + stat_binhex()</code></pre>
<p><img src="docs/examples/ggcyto/ggplot.flowSet.2d_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<pre class="r"><code># change the smooth color 
myColor &lt;- rev(RColorBrewer::brewer.pal(11, &quot;Spectral&quot;))
myColor_scale_fill &lt;- scale_fill_gradientn(colours = myColor)
p + myColor_scale_fill + stat_binhex()</code></pre>
<p><img src="docs/examples/ggcyto/ggplot.flowSet.2d_files/figure-html/unnamed-chunk-3-2.png" width="672" /></p>
<pre class="r"><code>#change the bins
p + myColor_scale_fill + stat_binhex(bins = 64)</code></pre>
<p><img src="docs/examples/ggcyto/ggplot.flowSet.2d_files/figure-html/unnamed-chunk-3-3.png" width="672" /></p>
<pre class="r"><code># sqr trans binned color
myColor_scale_fill_sqrt &lt;- scale_fill_gradientn(colours = myColor, trans = &quot;sqrt&quot;)
p1 &lt;- p + myColor_scale_fill_sqrt + stat_binhex(bins = 64)
p1</code></pre>
<p><img src="docs/examples/ggcyto/ggplot.flowSet.2d_files/figure-html/unnamed-chunk-3-4.png" width="672" /></p>
<pre class="r"><code># add boundary limits
p1 &lt;- p1 + ylim(c(10,9e2)) + xlim(c(10,9e2))   
p1</code></pre>
<p><img src="docs/examples/ggcyto/ggplot.flowSet.2d_files/figure-html/unnamed-chunk-3-5.png" width="672" /></p>
<pre class="r"><code># add contour
p &lt;- p + myColor_scale_fill
p + stat_binhex(bins = 64) + geom_density2d(colour = &quot;black&quot;)</code></pre>
<p><img src="docs/examples/ggcyto/ggplot.flowSet.2d_files/figure-html/unnamed-chunk-3-6.png" width="672" /></p>
<pre class="r"><code># non-binned dot plot
df &lt;- fortify(fr)
cols &lt;- densCols(df[,`FSC-H`], df[,`SSC-H`], colramp = flowViz::flowViz.par.get(&quot;argcolramp&quot;))
p1 &lt;- ggplot(df, aes(x = `FSC-H`, y =  `SSC-H`))
p1 + geom_point(color = cols) </code></pre>
<p><img src="docs/examples/ggcyto/ggplot.flowSet.2d_files/figure-html/unnamed-chunk-3-7.png" width="672" /></p>
<pre class="r"><code># multiple samples
p1 &lt;- ggplot(mapping = aes(x = `FSC-H`, y =  `SSC-H`)) + myColor_scale_fill + facet_grid(Patient~Visit)
p1 + stat_binhex(data = fs, bins = 64)</code></pre>
<p><img src="docs/examples/ggcyto/ggplot.flowSet.2d_files/figure-html/unnamed-chunk-3-8.png" width="672" /></p>
<pre class="r"><code># color scale is different when plotting single sample
p1 + stat_binhex(data = fs[6], bins = 64)</code></pre>
<p><img src="docs/examples/ggcyto/ggplot.flowSet.2d_files/figure-html/unnamed-chunk-3-9.png" width="672" /></p>
<pre class="r"><code># display density instead
p1 + stat_binhex(data = fs[6], bins = 64, aes(fill = ..density..))</code></pre>
<p><img src="docs/examples/ggcyto/ggplot.flowSet.2d_files/figure-html/unnamed-chunk-3-10.png" width="672" /></p>
<pre class="r"><code># the color scale difference is reduced
p1 + stat_binhex(data = fs, bins = 64, aes(fill = ..density..))</code></pre>
<p><img src="docs/examples/ggcyto/ggplot.flowSet.2d_files/figure-html/unnamed-chunk-3-11.png" width="672" /></p>
<pre class="r"><code># non-binned dot plot
df &lt;- fortify(fr)
cols &lt;- densCols(df[,`FSC-H`], df[,`SSC-H`], colramp = flowViz::flowViz.par.get(&quot;argcolramp&quot;))
p &lt;- ggplot(df, aes(x = `FSC-H`, y =  `SSC-H`))
p + geom_point(color = cols) </code></pre>
<p><img src="docs/examples/ggcyto/ggplot.flowSet.2d_files/figure-html/unnamed-chunk-3-12.png" width="672" /></p>
