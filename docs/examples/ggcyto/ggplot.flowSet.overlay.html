---
title: "Add overlay plot with ggplot2"
author: "Mike Jiang"
output:
  html_document:
    keep_md: yes
vignette: >    
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{Add overlay plot with ggplot2}        
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p><code>ggcyto</code> makes <code>ggplot2</code> to be able to work with <code>Cytometry</code> data, namely <code>flowSet/ncdfFlowSet</code> or <code>flowFrame</code> S4 objects.</p>
<pre class="r"><code>library(ggcyto)
data(GvHD)
fs &lt;- GvHD[subset(pData(GvHD), Patient %in%5:7 &amp; Visit %in% c(5:6))[[&quot;name&quot;]]]
fr &lt;- fs[[1]]</code></pre>
<div id="add-other-gated-data-as-the-overlays" class="section level2">
<h2>add other gated data as the overlays</h2>
<pre class="r"><code>p &lt;- ggplot(fr, aes(x = `FSC-H`, y =  `SSC-H`))

# change the smooth color 
myColor &lt;- rev(RColorBrewer::brewer.pal(11, &quot;Spectral&quot;))
myColor_scale_fill &lt;- scale_fill_gradientn(colours = myColor)
# get a gated data
lg &lt;- flowStats::lymphGate(fr, channels=c(&quot;FSC-H&quot;, &quot;SSC-H&quot;),scale=0.6)
overlay.fr &lt;- Subset(fr, lg)

# add the overlay and dim the background
p1 &lt;- p + stat_binhex(bins = 64, alpha = 0.2)
p1 &lt;- p1 + geom_point(data = overlay.fr, color = &quot;red&quot;, cex = 0.5, pch = 19)
p1</code></pre>
<p><img src="docs/examples/ggcyto/ggplot.flowSet.overlay_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<pre class="r"><code># another overlay 
rect.g &lt;- rectangleGate(list(&quot;FSC-H&quot; =  c(300,500), &quot;SSC-H&quot; = c(50,200)))
overlay.fr2 &lt;- Subset(fr, rect.g)
p1 + geom_point(data = overlay.fr2, color = &quot;black&quot;, cex = 0.5, pch = 19)</code></pre>
<p><img src="docs/examples/ggcyto/ggplot.flowSet.overlay_files/figure-html/unnamed-chunk-3-2.png" width="672" /></p>
<pre class="r"><code># overlay for multiple samples
overlay.fs1 &lt;- Subset(fs, lg)
overlay.fs2 &lt;- Subset(fs, rect.g)
ggplot(fs, aes(x = `FSC-H`, y =  `SSC-H`)) + 
          scale_fill_gradientn(colours = myColor)  +
          stat_binhex(bins = 64, alpha = 0.2) +
          geom_point(data = overlay.fs1, color = &quot;red&quot;, cex = 0.5, pch = 19) +
          geom_point(data = overlay.fs2, color = &quot;black&quot;, cex = 0.5, pch = 19) +
          facet_grid(Patient ~ Visit)</code></pre>
<p><img src="docs/examples/ggcyto/ggplot.flowSet.overlay_files/figure-html/unnamed-chunk-3-3.png" width="672" /></p>
</div>
